- name: Get infoblox.nios_modules version
  command: ansible-galaxy collection list infoblox.nios_modules
  register: infoblox_collection_list
  changed_when: false

- name: Extract version string (e.g., 1.7.2)
  set_fact:
    infoblox_version_str: "{{ (infoblox_collection_list.stdout | regex_search('infoblox\\.nios_modules\\s+(\\S+)', '\\1'))[0] }}"

- name: Split version into major and minor
  set_fact:
    infoblox_major_version: "{{ infoblox_version_str.split('.')[0] }}"
    infoblox_minor_version: "{{ infoblox_version_str.split('.')[1] }}"

- name: SHOW INFOBLOX VERSION
  debug:
    msg: "infoblox_major_version={{ infoblox_major_version }}, infoblox_minor_version={{ infoblox_minor_version }}"
